import lib .

module large-elim/concrete/zipwith/tvfold (F: â˜… â” â˜… â” â˜…) {rF: RespTpEq2 Â·F} .

import tyvec .
import foldr Â·F -rF.

TVFold : Î  n: Nat. ğ’ŒTyVec (succ n) â” â˜…
= Î» n: Nat. Î» L: ğ’ŒTyVec (succ n). âˆ€ X: â˜…. TVFoldR n Â·L Â·X â¾ X .

tvFoldSubst
: âˆ€ n: Nat. âˆ€ L1: ğ’ŒTyVec (succ n). âˆ€ L2: ğ’ŒTyVec (succ n).
  TVEq (succ n) Â·L1 Â·L2 â¾ TpEq Â·(TVFold n Â·L1) Â·(TVFold n Â·L2)
= Î› n. Î› L1. Î› L2. Î› eqL12.
  intrTpEq
    -(intrCast
        -(Î» x. Î› X. Î› fr.
          x -((tvFoldRSubst -n Â·L2 Â·X -n -(tvSym -(succ n) -eqL12)).1 fr))
        -(Î» x. Î²))
    -(intrCast
        -(Î» x. Î› X. Î› fr.
          x -((tvFoldRSubst -n Â·L1 Â·X -n -eqL12).1 fr))
        -(Î» x. Î²))
.

tvFoldZEq : âˆ€ L: ğ’ŒTyVec num1. TpEq Â·(TVHead zero Â·L) Â·(TVFold zero Â·L)
= Î› L.
  intrTpEq
    -(intrCast
        -(Î» x. Î› X. Î› fr. tpEq2 -(tvFoldRUnique -zero fr (tvFoldRZ' Â·L)) x)
        -(Î» x. Î²))
    -(intrCast
        -(Î» x. x -(tvFoldRZ' Â·L))
        -(Î» x. Î²))
.

tvFoldZ : âˆ€ L: ğ’ŒTyVec num1. TVFoldR zero Â·L Â·(TVFold zero Â·L)
= Î› L. tvFoldRResp -zero (tvFoldRZ' Â·L) -(tvFoldZEq Â·L) .

tvFoldSEq
: âˆ€ n: Nat. âˆ€ L: ğ’ŒTyVec (add num2 n).
  TVFoldR n Â·(TVTail (succ n) Â·L) Â·(TVFold n Â·(TVTail (succ n) Â·L)) â”
  TpEq Â·(F Â·(TVHead (succ n) Â·L) Â·(TVFold n Â·(TVTail (succ n) Â·L))) Â·(TVFold (succ n) Â·L)
= Î› n. Î› L. Î» fr.
  [fr' = tvFoldRS' -n Â·L fr]
- intrTpEq
    -(intrCast
        -(Î» x. Î› X. Î› fr''.
          tpEq1 -(tvFoldRUnique -(succ n) Â·L fr' fr'') x)
        -(Î» x. Î²))
    -(intrCast
        -(Î» x. x -(tvFoldRS' -n fr))
        -(Î» x. Î²)).

tvFoldS
: âˆ€ n: Nat. âˆ€ L: ğ’ŒTyVec (add num2 n). TVFoldR n Â·(TVTail (succ n) Â·L) Â·(TVFold n Â·(TVTail (succ n) Â·L)) â”
  TVFoldR (succ n) Â·L Â·(TVFold (succ n) Â·L)
= Î› n. Î› L. Î» fr.
  tvFoldRResp -(succ n) Â·L
    (tvFoldRS' -n fr) Â·(TVFold (succ n) Â·L) -(tvFoldSEq -n Â·L fr) .

tvFoldREx : Î  n: Nat. âˆ€ L: ğ’ŒTyVec (succ n). TVFoldR n Â·L Â·(TVFold n Â·L)
= Î» n.
  Î¼ mk. n {
  | zero â” tvFoldZ
  | succ n' â” Î› L.
    [n'' = to/Nat -isType/mk n']
  - tvFoldS -n'' Â·L (mk n' Â·(TVTail (succ n'') Â·L))
  } .

tvFoldZC
: âˆ€ L: ğ’ŒTyVec num1. TpEq Â·(TVFold zero Â·L) Â·(TVHead zero Â·L)
= Î› L. tpEqSym -(tvFoldZEq Â·L) .

unrollTVFoldZ : âˆ€ L: ğ’ŒTyVec num1. TVFold zero Â·L â” TVHead zero Â·L
= Î› L. tpEq1 -(tvFoldZC Â·L) .

rollTVFoldZC : âˆ€ L: ğ’ŒTyVec num1. TVHead zero Â·L â” TVFold zero Â·L
= Î› L. tpEq2 -(tvFoldZC Â·L) .

tvFoldSC
: âˆ€ n: Nat. âˆ€ L: ğ’ŒTyVec (add num2 n).
  TpEq Â·(TVFold (succ n) Â·L) Â·(F Â·(TVHead (succ n) Â·L) Â·(TVFold n Â·(TVTail (succ n) Â·L)))
= Î› n. Î› L. sym -(tvFoldSEq -n (tvFoldREx n Â·(TVTail (succ n) Â·L))) .

unrollTVFoldS
: âˆ€ n: Nat. âˆ€ L: ğ’ŒTyVec (add num2 n).
  TVFold (succ n) Â·L â” F Â·(TVHead (succ n) Â·L) Â·(TVFold n Â·(TVTail (succ n) Â·L))
= Î› n. Î› L. tpEq1 -(tvFoldSC -n Â·L) .

rollTVFoldS
: âˆ€ n: Nat. âˆ€ L: ğ’ŒTyVec (add num2 n).
  F Â·(TVHead (succ n) Â·L) Â·(TVFold n Â·(TVTail (succ n) Â·L)) â” TVFold (succ n) Â·L
= Î› n. Î› L. tpEq2 -(tvFoldSC -n Â·L) .

tvFoldZC'
: âˆ€ X: â˜…. TpEq Â·(TVFold zero Â·(TVCons zero Â·X Â·TVNil)) Â·X
= Î› X. trans -(tvFoldZC Â·(TVCons zero Â·X Â·TVNil)) -(tvConsZC -zero Â·X Â·TVNil)
.

unrollTVFoldZ'
: âˆ€ X: â˜…. TVFold zero Â·(TVCons zero Â·X Â·TVNil) â” X
= Î› X. tpEq1 -(tvFoldZC' Â·X) .

rollTVFoldZ'
: âˆ€ X: â˜…. X â” TVFold zero Â·(TVCons zero Â·X Â·TVNil)
= Î› X. tpEq2 -(tvFoldZC' Â·X) .

tvFoldSC'
: âˆ€ n: Nat. âˆ€ X: â˜…. âˆ€ L: ğ’ŒTyVec (succ n).
  TpEq Â·(TVFold (succ n) Â·(TVCons (succ n) Â·X Â·L)) Â·(F Â·X Â·(TVFold n Â·L))
= Î› n. Î› X. Î› L.
  trans
   -(tvFoldSC -n Â·(TVCons (succ n) Â·X Â·L))
   -(rF -(tvConsZC -(succ n) Â·X Â·L)
      -(tvFoldSubst -n Â·(TVTail (succ n) Â·(TVCons (succ n) Â·X Â·L)) Â·L
         -(tvTailConsC -(succ n) Â·X Â·L)))
.

unrollTVFoldS'
: âˆ€ n: Nat. âˆ€ X: â˜…. âˆ€ L: ğ’ŒTyVec (succ n).
  TVFold (succ n) Â·(TVCons (succ n) Â·X Â·L) â” F Â·X Â·(TVFold n Â·L)
= Î› n. Î› X. Î› L. tpEq1 -(tvFoldSC' -n Â·X Â·L) .

rollTVFoldS'
: âˆ€ n: Nat. âˆ€ X: â˜…. âˆ€ L: ğ’ŒTyVec (succ n).
  F Â·X Â·(TVFold n Â·L) â” TVFold (succ n) Â·(TVCons (succ n) Â·X Â·L)
= Î› n. Î› X. Î› L. tpEq2 -(tvFoldSC' -n Â·X Â·L) .
